<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>course10-js运动应用</title>		
		<style>
			body, ul, li{
				width: 100%; margin: 0;padding: 0;list-style: none;
			}
			h3{
				width: 100%; margin: 50px 490px;
			}
			#play{
				width: 400px;height: 430px;background: #999;margin: 50px auto;
			}
			.big_img{
				width: 400px;height: 320px;background: #333;overflow: hidden;position: relative;
			}
			.big_img .mark_left{
				width: 200px;height: 320px;position: absolute;left: 0;top:0;background: red;opacity: 0;z-index: 3000;
			}
			.big_img .mark_right{
				width: 200px;height: 320px;position: absolute;right: 0;top:0;background: green;opacity: 0;z-index: 3000;
			}
			.big_img .prev{
				width: 60px;height: 60px;position: absolute;top: 145px;left: 10px;z-index: 3001;
				cursor: pointer;background: url(imgs/flash/btn.gif) no-repeat 0 0;display: none;
			}
			.big_img .next{
				width: 60px;height: 60px;position: absolute;top: 145px;right: 10px;z-index: 3001;
				cursor: pointer;background: url(imgs/flash/btn.gif) no-repeat 0 -60px;display: none;
			}
			.big_img li{
				width: 400px;height: 320px;overflow: hidden;background: no-repeat url(imgs/flash/loading.gif) center center;
				position: absolute;top: 0;left: 0;
			}
			.small_img{
				width: 390px;height: 94px;position: relative;top: 7px;left: 10px;overflow: hidden;
			}
			.small_img ul{
				height: 94px;position: absolute;top: 0;left: 0;
			}
			.small_img ul li{
				width: 120px;height: 94px;float: left;padding-right: 10px;cursor: pointer;
				background: no-repeat url(imgs/flash/loading.gif) center center;opacity: 0.5;
			}
			.small_img ul li img{width: 120px;height: 94px;float: left;}
		</style>
		<script type="text/javascript" src="js/Cooler-1.0.0.js"></script>		<!--引入js运动框架-->
	</head>
	<body>
		
		<!---------------- 多物体运动框架的应用：一个flash自动轮播图 ------------------>
		<h3>多物体运动框架的应用：一个flash自动轮播图</h3>
		<div id="play">						
			<ul class="big_img">
				<a class="mark_left"></a>
				<a class="mark_right"></a>
				<div class="prev"></div>
				<div class="next"></div>
				<li style="z-index: 1;">
					<img src="imgs/flash/1.jpg" />
				</li>
				<li>
					<img src="imgs/flash/2.jpg" />
				</li>
				<li>
					<img src="imgs/flash/3.jpg" />
				</li>
				<li>
					<img src="imgs/flash/4.jpg" />
				</li>
				<li>
					<img src="imgs/flash/5.jpg" />
				</li>
				<li>
					<img src="imgs/flash/6.jpg" />
				</li>
			</ul>
			<div class="small_img">
				<ul>
					<li>
						<img src="imgs/flash/1.jpg" />
					</li>
					<li>
						<img src="imgs/flash/2.jpg" />
					</li>
					<li>
						<img src="imgs/flash/3.jpg" />
					</li>
					<li>
						<img src="imgs/flash/4.jpg" />
					</li>
					<li>
						<img src="imgs/flash/5.jpg" />
					</li>
					<li>
						<img src="imgs/flash/6.jpg" />
					</li>
				</ul>
			</div>
		</div>
		
		<script>
		window.onload=function()
		{
			var oPlay=document.getElementById("play");
			var oMark_left=getByClass(oPlay, "mark_left")[0];			//调用getByClass函数引入类元素
			var oMark_right=getByClass(oPlay, "mark_right")[0];
			var oPrev=getByClass(oPlay, "prev")[0];
			var oNext=getByClass(oPlay, "next")[0];
			
			//当鼠标移入<a>区域时，显示左右切换按钮
			oPrev.onmouseover=oMark_left.onmouseover=function()
			{
				oPrev.style.display="block";
			};			
			oPrev.onmouseout=oMark_left.onmouseout=function()
			{
				oPrev.style.display="none";				
			};
			oNext.onmouseover=oMark_right.onmouseover=function()
			{				
				oNext.style.display="block";
			};
			oNext.onmouseout=oMark_right.onmouseout=function()
			{				
				oNext.style.display="none";
			};
			
			var oBig_img=getByClass(oPlay, "big_img")[0];
			var aBigLi=oBig_img.getElementsByTagName("li");
			
			var oSmall_img=getByClass(oPlay, "small_img")[0];
			var oSmallUl=oSmall_img.getElementsByTagName("ul")[0];
			var aSmallLi=oSmall_img.getElementsByTagName("li");
			var nowIndex=1;			//定义原始图层为1								
			var now=0;				//定义一个now来代表当前选择哪个图片								
			
			//smallUl的宽度等于若干个li宽度之和
			oSmallUl.style.width=aSmallLi.length*aSmallLi[0].offsetWidth+"px";	
			
			for(var i=0; i<aSmallLi.length; i++)		
			{
				aSmallLi[i].index=i;				
				aSmallLi[i].onclick=function()			//小图片被点击，切换图片
				{
					if(this.index==now) return;			//当点击的是当前已选中图片时，返回值为空，不执行下面操作
					now=this.index;						//否则执行（等同于if...else...）										
					tab();				//执行切换
				};
				
				aSmallLi[i].onmouseover=function()
				{
					move(this, "opacity", 100);			//鼠标靠近，去掉滤镜
				};
				aSmallLi[i].onmouseout=function()
				{
					if(this.index!=now)					//当鼠标移到另一个图片时，即不是当前
					{
						move(this, "opacity", 50)		//当前滤镜恢复
					}					
				}
			}
			
			function tab()		//一个实现图片切换的封装函数
			{
				aBigLi[now].style["z-index"]=nowIndex++;	//改变大图片的显示图层，实现切换图片，当前图层在原图层上加一		
										
				for(var i=0; i<aSmallLi.length; i++)
				{
					move(aSmallLi[i],"opacity",60);			//所以图片显示滤镜
				}
				move(aBigLi[now], "opacity", 100);			//当选中当前图片，滤镜去掉			
										
				aBigLi[now].style.height=0;					//初始图片的高度为零
				move(aBigLi[now], "height", 320);			//选中的图片，高度逐渐增加到320px，实现往下滚的切换效果
				
				/*	小图片左右滚动的问题
				 
				 	举例：假设点击next，往右移
				 *  点击第几个小图		小ul向左移的距离（left的值减小）
				 * 		0				0
				 * 		1				0
				 * 		2				1个li的宽（-1*aSmallLi[0].offsetWidth）
				 * 		3				2个li的宽（-2*aSmallLi[0].offsetWidth）
				 * 		4				3个li的框（-3*aSmallLi[0].offsetWidth）
				 * 		...
				 * 		n				-(n-1)*aSmallLi[0].offsetWidth
				 * 
				 * */
				
				if(now==0)		//now=0在初始位置
				{
					move(oSmallUl, "left", 0);		//初始位置left=0
				}
				else if(now==aSmallLi.length-1)		//终点位置
				{
					move(oSmallUl,"left", -(now-2)*aSmallLi[0].offsetWidth);	//终点的left跟倒数第二的left值相等（点击最后一个，不切换）
				}
				else
				{
					move(oSmallUl,"left", -(now-1)*aSmallLi[0].offsetWidth);	//其余的切换
				}				
			};
			
			oPrev.onclick=function()		//点击左按钮触发事件
			{
				now--;				//left减小
				if(now==-1)			//往左到顶时		
				{
					now=aSmallLi.length-1;		//即左初始点跳到右终点，继续向左切换（循环）
				}
				tab();				//调用切换图片函数
			};
			oNext.onclick=function()
			{
				now++;				//left增大
				if(now==aSmallLi.length)		//向右到达终点	
				{
					now=0;						//即右终点跳回初始点，继续向右切换（循环）
				}				
				tab();				//调用切换图片函数
			};
			
			var timer=setInterval(oNext.onclick, 2000);			//定时器自定滚动
			oPlay.onmouseover=function()
			{
				clearInterval(timer);			//鼠标放上，停止滚动
			};
			oPlay.onmouseout=function()
			{
				timer=setInterval(oNext.onclick, 2000);			//鼠标离开，恢复滚动
			}
		};
			
			
		</script>
	</body>
</html>
